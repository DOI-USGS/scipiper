<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Alison Appling" />

<meta name="date" content="2018-05-23" />

<title>Task plans</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Task plans</h1>
<h4 class="author"><em>Alison Appling</em></h4>
<h4 class="date"><em>May 23, 2018</em></h4>



<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>({
  <span class="kw">library</span>(scipiper)
  <span class="kw">library</span>(dplyr)
})</code></pre></div>
</div>
<div id="basic-task-file-generation" class="section level2">
<h2>Basic task file generation</h2>
<p>Suppose you want to run the following 3 steps for each of a bunch of different states. Here are some dummy functions representing those steps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step 1: prepare some data given the info in prep_name, arg2, file 'A.txt', and R object 'B'</span>
prep &lt;-<span class="st"> </span>function(prep_name) {
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">'preparing %s'</span>, prep_name))
  <span class="kw">return</span>(prep_name)
}

<span class="co"># step 2: visualize the data</span>
visualize &lt;-<span class="st"> </span>function(plot_name, state_data, state_capital) {
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">'visualizing %s - %s'</span>, plot_name, state_capital))
  <span class="kw">file.create</span>(plot_name, <span class="dt">showWarnings=</span><span class="ot">FALSE</span>)
}

<span class="co"># step 3: create the report</span>
report &lt;-<span class="st"> </span>function(report_name) {
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">'reporting on %s'</span>, report_name))
  <span class="kw">file.create</span>(report_name, <span class="dt">showWarnings=</span><span class="ot">FALSE</span>)
}</code></pre></div>
<p>Here are the states and state capitals for which you want to run the above steps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">task_config &lt;-<span class="st"> </span><span class="kw">data_frame</span>(
  <span class="dt">id=</span><span class="kw">c</span>(<span class="st">'WI'</span>,<span class="st">'AZ'</span>,<span class="st">'PA'</span>),
  <span class="dt">capital=</span><span class="kw">c</span>(<span class="st">'Madison'</span>,<span class="st">'Phoenix'</span>,<span class="st">'Harrisburg'</span>)
)</code></pre></div>
<div id="creating-task_steps" class="section level3">
<h3>Creating task_steps</h3>
<p>To use <code>scipiper</code> to run these tasks, first generate a set of instructions, or <code>task_step</code>s, for how to create the remake recipe for each task-step combination. Here are some ways to generate task steps. Note that many arguments to <code>create_task_step()</code> can be custom functions of step_name, task_name, and the output of any preceding arguments; see the defaults in <code>?create_task_step</code> for list of the arguments each function can see and use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># step1 creates recipes like this:</span>
<span class="co"># WI_prep:</span>
<span class="co">#   command: prep(I('WI'))</span>
step1 &lt;-<span class="st"> </span><span class="kw">create_task_step</span>(<span class="dt">step_name =</span> <span class="st">'prep'</span>)

<span class="co"># step2 creates recipes like this:</span>
<span class="co"># WI_plot.png:</span>
<span class="co">#   command: visualize(</span>
<span class="co">#       plot_name = target_name, </span>
<span class="co">#       state_data = WI_prep,</span>
<span class="co">#       state_capital = I('Madison'))</span>
step2 &lt;-<span class="st"> </span><span class="kw">create_task_step</span>(
  <span class="dt">step_name =</span> <span class="st">'plot'</span>,
  <span class="dt">target_name =</span> function(task_name, ...) {
    <span class="kw">sprintf</span>(<span class="st">'%s_plot.png'</span>, task_name)
  },
  <span class="dt">command =</span> function(target_name, task_name, ...) {
    capital &lt;-<span class="st"> </span>task_config[task_config$id ==<span class="st"> </span>task_name, <span class="st">'capital'</span>]
    <span class="kw">psprintf</span>(
      <span class="st">&quot;visualize(&quot;</span>,
      <span class="st">&quot;plot_name = target_name,&quot;</span>,
      <span class="st">&quot;state_data = %s_prep,&quot;</span>=task_name,
      <span class="st">&quot;state_capital = I('%s'))&quot;</span>=capital
      )
  })

<span class="co"># step3 creates recipes like this:</span>
<span class="co"># WI.pdf:</span>
<span class="co">#   command: report(target_name)</span>
<span class="co">#   depends:</span>
<span class="co">#    - WI_plot.png</span>
step3 &lt;-<span class="st"> </span><span class="kw">create_task_step</span>(
  <span class="dt">step_name =</span> <span class="st">'report'</span>,
  <span class="dt">target_name =</span> function(task_name, ...) {
    <span class="kw">sprintf</span>(<span class="st">'%s.pdf'</span>, task_name)
  },
  <span class="dt">depends =</span> function(task_name, ...) {
    <span class="kw">sprintf</span>(<span class="st">'%s_plot.png'</span>, task_name)
  },
  <span class="dt">command =</span> function(task_name, step_name, ...) {
    <span class="kw">sprintf</span>(<span class="st">&quot;report(target_name)&quot;</span>, task_name)
  })</code></pre></div>
<p>You’ve probably noticed the <code>...</code> in the arguments list of each function you pass to <code>create_task_step</code>. You don’t get to decide what’s available in the <code>...</code>s, but you do get do decide whether you use that information. Above the only named arguments we use are <code>task_name</code> and sometimes <code>step_name</code>, but other named arguments are passed in to these functions when the task step is turned into a task plan (next section). These other arguments allow you to look to other information for this task-step, or to info about previous steps within the task.</p>
<p>• If you’re writing a <code>target_name</code>, you have access to the evaluated <code>step_name</code> for this task-step. Therefore, your function definition can be <code>function(...)</code> or <code>function(step_name, ...)</code> depending on whether you plan to use the step_name information or not. It’ll get passed in regardless of whether you include that argument in the definition. • If you’re writing a <code>depends</code> function, you have access to the evaluated <code>target_name</code> and <code>step_name</code>. Therefore, your function definition can be either of these: <code>function(target_name, ...)</code>, <code>function(target_name, step_name, ...)</code> • If you’re writing a <code>command</code> function, you have access to the evaluated <code>target_name</code>, <code>step_name</code>, and <code>depends</code>. Therefore, your function definition can be any of these: <code>function(target_name, ...)</code>, <code>function(target_name, step_name, ...)</code>, or <code>function(target_name, step_name, depends, ...)</code> • You can also get the evaluated values of <code>step_name</code>, <code>target_name</code>, <code>depends</code>, or <code>command</code> for any of the preceding steps for this task; all of these are available elements of the <code>steps</code> argument, which is a list named <code>steps</code>. Therefore, your function definition can be any of these: <code>function(steps, ...)</code>, <code>function(target_name, steps, ...)</code>, <code>function(target_name, step_name, steps, ...)</code>, or <code>function(target_name, step_name, depends, steps, ...)</code>. This is most useful if you’re defining the 2nd, 3rd, etc. step, because then there’s information to look back at. For example, if step 2 uses the target from step 1 as input, and if step 1 is named “prepare”, then your definition for step 2 might look something like this:</p>
<pre><code>step2 &lt;- create_task_step(
  step_name = 'plot',
  target_name = function(target_name, ...) {
    sprintf(&quot;out/%s.png&quot;, target_name)
  },
  command = function(steps, ...) {
    sprintf('visualize(\'%s\', target_name)', steps[['prepare']]$target_name)
  }
)</code></pre>
<p>As illustrated above, referencing the previous step’s output can be handy for multi-step tasks where each step depends on output from the previous step.</p>
</div>
<div id="creating-a-task-plan" class="section level3">
<h3>Creating a task plan</h3>
<p>You can now create a task_plan that wraps the tasks and steps together. In the following call to <code>create_task_plan</code>, a couple of things happen. The main thing is that the steps you identified are organized into an R object that <code>scipiper</code> can use efficiently later. The other thing is that when the default argument <code>add_complete=TRUE</code> is accepted (e.g., by not specifying <code>add_complete</code> at all), a final step gets tacked onto the list. The final step generates an .ind file for each task once all other steps for that task have been completed (or, if <code>final_steps</code> is specified, once those specified steps have been completed).</p>
<p>The main benefit of this <code>complete</code> step and the corresponding .ind file is speed: iteration over the complete task plan can be more efficient because the presence of an .ind file for a task can be used as a first-cut indication that the task doesn’t need to be built, such that iteration effort can be more efficiently spent on other tasks. The usual way that <code>remake</code> determines which tasks need to be rebuilt can be quite slow for large task lists or large output files, so speed here is a good thing.</p>
<p>One drawback of the <code>add_complete</code> system and corresponding .ind files is that the speed shortcut only works if the presence of these .ind files is a fairly accurate description of which tasks are up to date. If you build a complete task plan once, change an input, and intend to rebuild, then it’s strongly recommended that you delete the .ind files before calling <code>loop_tasks</code> again. If you don’t, nothing will break, but your build will be slower and will not include automatic retries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">task_plan_1 &lt;-<span class="st"> </span><span class="kw">create_task_plan</span>(
  task_config$id,
  <span class="kw">list</span>(step1, step2, step3),
  <span class="dt">final_steps=</span><span class="st">'report'</span>,
  <span class="dt">ind_dir=</span><span class="st">'states/log'</span>)</code></pre></div>
<p>You’ll need the <code>task_plan</code> R object for two things: to create a remake .yml makefile and to run <code>loop_tasks</code>.</p>
</div>
<div id="creating-a-task-makefile" class="section level3">
<h3>Creating a task makefile</h3>
<p>Here’s how to create a task makefile from a task plan:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">create_task_makefile</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">makefile=</span><span class="st">'task_plan_1.yml'</span>,
  <span class="dt">include=</span><span class="kw">c</span>(),
  <span class="dt">packages=</span><span class="kw">c</span>(<span class="st">'ggplot2'</span>),
  <span class="dt">sources=</span><span class="kw">c</span>(<span class="st">'script.R'</span>),
  <span class="dt">file_extensions=</span><span class="kw">c</span>(<span class="st">'ind'</span>),
  <span class="dt">ind_complete=</span><span class="ot">TRUE</span>)
## run all tasks with
## states/log/task_plan_1.ind:
##   command: make(I('task_plan_1'), remake_file='task_plan_1.yml')
## [1] &quot;task_plan_1.yml&quot;</code></pre></div>
<p>Here are the contents of task_plan_1.yml:</p>
<pre><code># Do not edit - automatically generated
# from the task_makefile.mustache template
# by create_task_makefile() via eval()

target_default: task_plan_1

packages:
  - ggplot2

sources:
  - script.R

file_extensions:
  - &quot;ind&quot;

targets:
  # --- WI --- #
  
  WI_prep:
    command: prep(I('WI'))

  WI_plot.png:
    command: visualize(
      plot_name = target_name,
      state_data = WI_prep,
      state_capital = I('Madison'))

  WI.pdf:
    command: report(target_name)
    depends:
      - WI_plot.png

  states/log/WI.ind:
    command: sc_indicate(target_name)
    depends:
      - WI.pdf

  # --- AZ --- #
  
  AZ_prep:
    command: prep(I('AZ'))

  AZ_plot.png:
    command: visualize(
      plot_name = target_name,
      state_data = AZ_prep,
      state_capital = I('Phoenix'))

  AZ.pdf:
    command: report(target_name)
    depends:
      - AZ_plot.png

  states/log/AZ.ind:
    command: sc_indicate(target_name)
    depends:
      - AZ.pdf

  # --- PA --- #
  
  PA_prep:
    command: prep(I('PA'))

  PA_plot.png:
    command: visualize(
      plot_name = target_name,
      state_data = PA_prep,
      state_capital = I('Harrisburg'))

  PA.pdf:
    command: report(target_name)
    depends:
      - PA_plot.png

  states/log/PA.ind:
    command: sc_indicate(target_name)
    depends:
      - PA.pdf

  # --- Overall job --- #

  task_plan_1:
    command: sc_indicate(I('states/log/task_plan_1.ind'), hash_depends=I(TRUE), depends_target=I('task_plan_1'), depends_makefile=I('task_plan_1.yml'))
    depends: 
      - states/log/WI.ind
      - states/log/AZ.ind
      - states/log/PA.ind</code></pre>
<p>Note that at the end of each state’s task list is a final task, e.g., <code>states/log/WI.ind</code>, that we didn’t directly specify in the task_plan. These recipes for the <code>complete</code> step were generated in <code>create_task_plan</code> as described above. These .ind files representing the completeness of each task are also used as the dependencies of the final target, <code>task_plan_1</code>, which describes all targets that must be complete to consider the whole task batch complete.</p>
</div>
<div id="executing-a-task-planmakefile" class="section level3">
<h3>Executing a task plan/makefile</h3>
<p>You can use <code>loop_tasks</code> with the <code>task_plan</code> and the <code>task_makefile</code> to run all the steps in all the tasks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>)
## 
                                                                               
### Starting loop attempt 1 of 30 with 3 of 3 tasks remaining:
## 
  Building WI [--------------------------------------------------------]   <span class="dv">0</span>%  preparing WI
## visualizing WI_plot.png - Madison
## reporting on WI.pdf
## 
  Building AZ [==<span class="er">================&gt;</span>-------------------------------------]  <span class="dv">33</span>%  preparing AZ
## visualizing AZ_plot.png - Phoenix
## reporting on AZ.pdf
## 
  Building PA [==<span class="er">==================================&gt;</span>-------------------]  <span class="dv">67</span>%  preparing PA
## visualizing PA_plot.png - Harrisburg
## reporting on PA.pdf
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Starting build at 2019-02-05 14:28:10
## &lt;  MAKE &gt; task_plan_1
## [    OK ] WI_prep
## [    OK ] AZ_prep
## [    OK ] PA_prep
## [    OK ] WI_plot.png
## [    OK ] WI.pdf
## [    OK ] states/log/WI.ind
## [    OK ] AZ_plot.png
## [    OK ] AZ.pdf
## [    OK ] states/log/AZ.ind
## [    OK ] PA_plot.png
## [    OK ] PA.pdf
## [    OK ] states/log/PA.ind
## [ BUILD ] task_plan_1       |  task_plan_1 &lt;- sc_indicate(&quot;states/log/t...
## Finished build at 2019-02-05 14:28:11
## Build completed in 0.00 minutes</code></pre></div>
<p>The benefits of using <code>loop_tasks</code> to run all the remake targets in task_plan_1.yml are:</p>
<ol style="list-style-type: decimal">
<li>baked-in retries during each execution of <code>loop_tasks</code></li>
<li>quicker restarts if <code>loop_tasks</code> gets interrupted partway through (e.g., if your computer runs out of battery or crashes)</li>
<li>the ability to easily run subsets of tasks and/or steps while you’re developing the analysis (see below)</li>
</ol>
<p>To use the baked-in retries effectively, simply ensure that the functions called in your task-steps throw errors (typically with <code>stop()</code>) when things go wrong. No need to build retries into the functions themselves because <code>loop_tasks</code> will take care of that for you. And if your function isn’t the sort that would benefit from retries - e.g., HTTP requests need retries, but a deterministic algorithm should just give up if it breaks - you can set <code>num_tries=1</code> in <code>loop_tasks</code>.</p>
</div>
</div>
<div id="forcing-rebuilds" class="section level2">
<h2>Forcing rebuilds</h2>
<div id="forcing-rebuild-for-one-task-step" class="section level3">
<h3>Forcing rebuild for one task-step</h3>
<p>If we try to <code>scmake</code> any of the targets in the task makefile without changing any of the inputs, <code>remake</code> correctly recognizes that they’re up to date already, and the target is not rebuilt. For example, because we ran <code>loop_tasks</code> above, <code>AZ_plot.png</code> is already <code>OK</code> when we try to build it again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scmake</span>(<span class="st">'AZ_plot.png'</span>, <span class="st">'task_plan_1.yml'</span>)
## Starting build at 2019-02-05 14:28:11
## &lt;  MAKE &gt; AZ_plot.png
## [    OK ] AZ_prep
## [    OK ] AZ_plot.png
## Finished build at 2019-02-05 14:28:11
## Build completed in 0.00 minutes</code></pre></div>
<p>One way to force the rebuild of a single target is to use <code>scdel</code>, like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scdel</span>(<span class="st">'AZ_plot.png'</span>, <span class="st">'task_plan_1.yml'</span>)
## (   DEL ) AZ_plot.png       |  file.remove(&quot;AZ_plot.png&quot;)</code></pre></div>
<p>Now when we <code>scmake</code> that target again, <code>AZ_plot.png</code> gets rebuilt:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scmake</span>(<span class="st">'AZ_plot.png'</span>, <span class="st">'task_plan_1.yml'</span>)
## Starting build at 2019-02-05 14:28:11
## &lt;  MAKE &gt; AZ_plot.png
## [    OK ] AZ_prep
## [ BUILD ] AZ_plot.png       |  visualize(plot_name = &quot;AZ_plot.png&quot;, sta...
## visualizing AZ_plot.png - Phoenix
## Finished build at 2019-02-05 14:28:11
## Build completed in 0.00 minutes</code></pre></div>
<p>Alternatively, and even faster to type than the 2-line solution above, we can force a rebuild with the <code>force=TRUE</code> argument to <code>scmake</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scmake</span>(<span class="st">'AZ_plot.png'</span>, <span class="st">'task_plan_1.yml'</span>, <span class="dt">force=</span><span class="ot">TRUE</span>)
## (   DEL ) AZ_plot.png       |  file.remove(&quot;AZ_plot.png&quot;)
## Starting build at 2019-02-05 14:28:11
## &lt;  MAKE &gt; AZ_plot.png
## [    OK ] AZ_prep
## [ BUILD ] AZ_plot.png       |  visualize(plot_name = &quot;AZ_plot.png&quot;, sta...
## visualizing AZ_plot.png - Phoenix
## Finished build at 2019-02-05 14:28:11
## Build completed in 0.00 minutes</code></pre></div>
</div>
<div id="forcing-rebuild-for-all-task-steps" class="section level3">
<h3>Forcing rebuild for all task-steps</h3>
<p>Similar to the one-target example, above, if we run the same <code>loop_tasks</code> command twice, nothing will get rebuilt the second time. Instead, all items will say <code>OK</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>)
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Starting build at 2019-02-05 14:28:11
## &lt;  MAKE &gt; task_plan_1
## [    OK ] WI_prep
## [    OK ] AZ_prep
## [    OK ] PA_prep
## [    OK ] WI_plot.png
## [    OK ] WI.pdf
## [    OK ] states/log/WI.ind
## [    OK ] AZ_plot.png
## [    OK ] AZ.pdf
## [    OK ] states/log/AZ.ind
## [    OK ] PA_plot.png
## [    OK ] PA.pdf
## [    OK ] states/log/PA.ind
## [    OK ] task_plan_1
## Finished build at 2019-02-05 14:28:11
## Build completed in 0.00 minutes</code></pre></div>
<p>One way to force a complete rebuild (not generally a good use of time, but sometimes necessary) is to use <code>scdel</code> with the <code>target_names</code> argument set to <code>list_all_targets([remake_file])</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scdel</span>(<span class="dt">target_names=</span><span class="kw">list_all_targets</span>(<span class="st">'task_plan_1.yml'</span>), <span class="dt">remake_file=</span><span class="st">'task_plan_1.yml'</span>)
## (   DEL ) WI_prep           |  rm(&quot;WI_prep&quot;)
## (   DEL ) WI_plot.png       |  file.remove(&quot;WI_plot.png&quot;)
## (   DEL ) WI.pdf            |  file.remove(&quot;WI.pdf&quot;)
## (   DEL ) states/log/WI.ind |  file.remove(&quot;states/log/WI.ind&quot;)
## (   DEL ) AZ_prep           |  rm(&quot;AZ_prep&quot;)
## (   DEL ) AZ_plot.png       |  file.remove(&quot;AZ_plot.png&quot;)
## (   DEL ) AZ.pdf            |  file.remove(&quot;AZ.pdf&quot;)
## (   DEL ) states/log/AZ.ind |  file.remove(&quot;states/log/AZ.ind&quot;)
## (   DEL ) PA_prep           |  rm(&quot;PA_prep&quot;)
## (   DEL ) PA_plot.png       |  file.remove(&quot;PA_plot.png&quot;)
## (   DEL ) PA.pdf            |  file.remove(&quot;PA.pdf&quot;)
## (   DEL ) states/log/PA.ind |  file.remove(&quot;states/log/PA.ind&quot;)
## (   DEL ) task_plan_1       |  rm(&quot;task_plan_1&quot;)</code></pre></div>
<p>Now when we run the entire loop, everything gets rebuilt:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>)
## 
                                                                               
### Starting loop attempt 1 of 30 with 3 of 3 tasks remaining:
## 
  Building WI [--------------------------------------------------------]   <span class="dv">0</span>%  preparing WI
## visualizing WI_plot.png - Madison
## reporting on WI.pdf
## 
  Building AZ [==<span class="er">================&gt;</span>-------------------------------------]  <span class="dv">33</span>%  preparing AZ
## visualizing AZ_plot.png - Phoenix
## reporting on AZ.pdf
## 
  Building PA [==<span class="er">==================================&gt;</span>-------------------]  <span class="dv">67</span>%  preparing PA
## visualizing PA_plot.png - Harrisburg
## reporting on PA.pdf
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Starting build at 2019-02-05 14:28:13
## &lt;  MAKE &gt; task_plan_1
## [    OK ] WI_prep
## [    OK ] AZ_prep
## [    OK ] PA_prep
## [    OK ] WI_plot.png
## [    OK ] WI.pdf
## [    OK ] states/log/WI.ind
## [    OK ] AZ_plot.png
## [    OK ] AZ.pdf
## [    OK ] states/log/AZ.ind
## [    OK ] PA_plot.png
## [    OK ] PA.pdf
## [    OK ] states/log/PA.ind
## [ BUILD ] task_plan_1       |  task_plan_1 &lt;- sc_indicate(&quot;states/log/t...
## Finished build at 2019-02-05 14:28:13
## Build completed in 0.00 minutes</code></pre></div>
<p>Again, the less-typing solution is to force a rebuild with the <code>force=TRUE</code> argument to <code>scmake</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scmake</span>(<span class="kw">list_all_targets</span>(<span class="st">'task_plan_1.yml'</span>), <span class="st">'task_plan_1.yml'</span>, <span class="dt">force=</span><span class="ot">TRUE</span>)
## (   DEL ) WI_prep           |  rm(&quot;WI_prep&quot;)
## (   DEL ) WI_plot.png       |  file.remove(&quot;WI_plot.png&quot;)
## (   DEL ) WI.pdf            |  file.remove(&quot;WI.pdf&quot;)
## (   DEL ) states/log/WI.ind |  file.remove(&quot;states/log/WI.ind&quot;)
## (   DEL ) AZ_prep           |  rm(&quot;AZ_prep&quot;)
## (   DEL ) AZ_plot.png       |  file.remove(&quot;AZ_plot.png&quot;)
## (   DEL ) AZ.pdf            |  file.remove(&quot;AZ.pdf&quot;)
## (   DEL ) states/log/AZ.ind |  file.remove(&quot;states/log/AZ.ind&quot;)
## (   DEL ) PA_prep           |  rm(&quot;PA_prep&quot;)
## (   DEL ) PA_plot.png       |  file.remove(&quot;PA_plot.png&quot;)
## (   DEL ) PA.pdf            |  file.remove(&quot;PA.pdf&quot;)
## (   DEL ) states/log/PA.ind |  file.remove(&quot;states/log/PA.ind&quot;)
## (   DEL ) task_plan_1       |  rm(&quot;task_plan_1&quot;)
## Starting build at 2019-02-05 14:28:13
## &lt;  MAKE &gt; WI_prep
## &lt;  MAKE &gt; WI_plot.png
## &lt;  MAKE &gt; WI.pdf
## &lt;  MAKE &gt; states/log/WI.ind
## &lt;  MAKE &gt; AZ_prep
## &lt;  MAKE &gt; AZ_plot.png
## &lt;  MAKE &gt; AZ.pdf
## &lt;  MAKE &gt; states/log/AZ.ind
## &lt;  MAKE &gt; PA_prep
## &lt;  MAKE &gt; PA_plot.png
## &lt;  MAKE &gt; PA.pdf
## &lt;  MAKE &gt; states/log/PA.ind
## &lt;  MAKE &gt; task_plan_1
## [ BUILD ] WI_prep           |  WI_prep &lt;- prep(&quot;WI&quot;)
## preparing WI
## [ BUILD ] AZ_prep           |  AZ_prep &lt;- prep(&quot;AZ&quot;)
## preparing AZ
## [ BUILD ] PA_prep           |  PA_prep &lt;- prep(&quot;PA&quot;)
## preparing PA
## [ BUILD ] WI_plot.png       |  visualize(plot_name = &quot;WI_plot.png&quot;, sta...
## visualizing WI_plot.png - Madison
## [ BUILD ] WI.pdf            |  report(&quot;WI.pdf&quot;)
## reporting on WI.pdf
## [ BUILD ] states/log/WI.ind |  sc_indicate(&quot;states/log/WI.ind&quot;)
## [ BUILD ] AZ_plot.png       |  visualize(plot_name = &quot;AZ_plot.png&quot;, sta...
## visualizing AZ_plot.png - Phoenix
## [ BUILD ] AZ.pdf            |  report(&quot;AZ.pdf&quot;)
## reporting on AZ.pdf
## [ BUILD ] states/log/AZ.ind |  sc_indicate(&quot;states/log/AZ.ind&quot;)
## [ BUILD ] PA_plot.png       |  visualize(plot_name = &quot;PA_plot.png&quot;, sta...
## visualizing PA_plot.png - Harrisburg
## [ BUILD ] PA.pdf            |  report(&quot;PA.pdf&quot;)
## reporting on PA.pdf
## [ BUILD ] states/log/PA.ind |  sc_indicate(&quot;states/log/PA.ind&quot;)
## [ BUILD ] task_plan_1       |  task_plan_1 &lt;- sc_indicate(&quot;states/log/t...
## Finished build at 2019-02-05 14:28:13
## Build completed in 0.01 minutes</code></pre></div>
</div>
</div>
<div id="developing-a-successful-loop" class="section level2">
<h2>Developing a successful loop</h2>
<p>Not analyses will go smoothly the first time you try. You can use <code>loop_tasks</code> to run just a few task-steps at a time at first, debugging before you launch a full batch.</p>
<p>Before we can demonstrate, we’ll need to delete all output files and remake status information again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scdel</span>(<span class="dt">target_names=</span><span class="kw">list_all_targets</span>(<span class="st">'task_plan_1.yml'</span>), <span class="dt">remake_file=</span><span class="st">'task_plan_1.yml'</span>)
## (   DEL ) WI_prep           |  rm(&quot;WI_prep&quot;)
## (   DEL ) WI_plot.png       |  file.remove(&quot;WI_plot.png&quot;)
## (   DEL ) WI.pdf            |  file.remove(&quot;WI.pdf&quot;)
## (   DEL ) states/log/WI.ind |  file.remove(&quot;states/log/WI.ind&quot;)
## (   DEL ) AZ_prep           |  rm(&quot;AZ_prep&quot;)
## (   DEL ) AZ_plot.png       |  file.remove(&quot;AZ_plot.png&quot;)
## (   DEL ) AZ.pdf            |  file.remove(&quot;AZ.pdf&quot;)
## (   DEL ) states/log/AZ.ind |  file.remove(&quot;states/log/AZ.ind&quot;)
## (   DEL ) PA_prep           |  rm(&quot;PA_prep&quot;)
## (   DEL ) PA_plot.png       |  file.remove(&quot;PA_plot.png&quot;)
## (   DEL ) PA.pdf            |  file.remove(&quot;PA.pdf&quot;)
## (   DEL ) states/log/PA.ind |  file.remove(&quot;states/log/PA.ind&quot;)
## (   DEL ) task_plan_1       |  rm(&quot;task_plan_1&quot;)</code></pre></div>
<p>You can specify an intersection of tasks and steps that you want to run. For example, let’s only run the prep step for PA first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>,
  <span class="dt">task_names=</span><span class="st">'PA'</span>,
  <span class="dt">step_names=</span><span class="st">'prep'</span>)
## 
                                                                               
### Starting loop attempt 1 of 30 with 1 of 1 tasks remaining:
## 
  Building PA [--------------------------------------------------------]   <span class="dv">0</span>%  preparing PA
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Set task_names=NULL, step_names=NULL to build the job target.
## Until then, expect this error:
##   'command for [target] did not create file'</code></pre></div>
<p>Note that an error is thrown at the end to prevent the indicator file from being created. This is useful because it means we can keep running <code>loop_tasks</code> on subsets of the batch until everything is done.</p>
<p>Alternatively, you can run a step (and any dependencies to that step) for all tasks. Here let’s run only the plotting steps (and therefore also the prepping steps) for all states:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>,
  <span class="dt">step_names=</span><span class="st">'plot'</span>)
## 
                                                                               
### Starting loop attempt 1 of 30 with 3 of 3 tasks remaining:
## 
  Building WI [--------------------------------------------------------]   <span class="dv">0</span>%  preparing WI
## visualizing WI_plot.png - Madison
## 
  Building AZ [==<span class="er">================&gt;</span>-------------------------------------]  <span class="dv">33</span>%  preparing AZ
## visualizing AZ_plot.png - Phoenix
## 
  Building PA [==<span class="er">==================================&gt;</span>-------------------]  <span class="dv">67</span>%  visualizing PA_plot.png -<span class="st"> </span>Harrisburg
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Checking file 1 of 3: WI_plot.png
## Checking file 2 of 3: AZ_plot.png
## Checking file 3 of 3: PA_plot.png
## Set task_names=NULL, step_names=NULL to build the job target.
## Until then, expect this error:
##   'command for [target] did not create file'</code></pre></div>
<p>Or you can run a complete task, or handful of tasks, without touching the others. Here we run PA and AZ only:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>,
  <span class="dt">task_names=</span><span class="kw">c</span>(<span class="st">'PA'</span>,<span class="st">'AZ'</span>))
## 
                                                                               
### Starting loop attempt 1 of 30 with 2 of 2 tasks remaining:
## 
  Building PA [--------------------------------------------------------]   <span class="dv">0</span>%  reporting on PA.pdf
## 
  Building AZ [==<span class="er">=========================&gt;</span>----------------------------]  <span class="dv">50</span>%  reporting on AZ.pdf
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Checking file 1 of 2: states/log/PA.ind
## Checking file 2 of 2: states/log/AZ.ind
## Set task_names=NULL, step_names=NULL to build the job target.
## Until then, expect this error:
##   'command for [target] did not create file'</code></pre></div>
<p>Now if we run the full loop without constraints, the only things left to build are the WI report, the final indicator for each task (built silently) and the final indicator file for the whole batch (target <code>task_plan_1</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loop_tasks</span>(
  <span class="dt">task_plan=</span>task_plan_1,
  <span class="dt">task_makefile=</span><span class="st">'task_plan_1.yml'</span>)
## 
                                                                               
### Starting loop attempt 1 of 30 with 1 of 3 tasks remaining:
## 
  Building WI [==<span class="er">==================================&gt;</span>-------------------]  <span class="dv">67</span>%  reporting on WI.pdf
## 
All tasks complete [==<span class="er">=================================================</span>] <span class="dv">100</span>%  
## 
## ### Final check for completeness of all targets
## Starting build at 2019-02-05 14:28:16
## &lt;  MAKE &gt; task_plan_1
## [    OK ] WI_prep
## [    OK ] AZ_prep
## [    OK ] PA_prep
## [    OK ] WI_plot.png
## [    OK ] WI.pdf
## [    OK ] states/log/WI.ind
## [    OK ] AZ_plot.png
## [    OK ] AZ.pdf
## [    OK ] states/log/AZ.ind
## [    OK ] PA_plot.png
## [    OK ] PA.pdf
## [    OK ] states/log/PA.ind
## [ BUILD ] task_plan_1       |  task_plan_1 &lt;- sc_indicate(&quot;states/log/t...
## Finished build at 2019-02-05 14:28:16
## Build completed in 0.00 minutes</code></pre></div>
</div>
<div id="indicator-files-options" class="section level2">
<h2>Indicator files options</h2>
<p>If you have a really lightweight project and want to skip the indicator files, you can do so. To skip the <code>complete</code> step and accompanying .ind files, set <code>add_complete=FALSE</code>. If you also intend not to create a final indicator file for the entire task batch, you can also skip setting <code>ind_dir</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">task_plan_2 &lt;-<span class="st"> </span><span class="kw">create_task_plan</span>(
  task_config$id,
  <span class="kw">list</span>(step1, step2, step3),
  <span class="dt">final_steps=</span><span class="st">'report'</span>,
  <span class="dt">add_complete=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>To avoid creating an indicator file when the entire batch is complete, set <code>ind_complete=FALSE</code> in <code>create_task_makefile</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">create_task_makefile</span>(
  <span class="dt">task_plan=</span>task_plan_2,
  <span class="dt">makefile=</span><span class="st">'task_plan_2.yml'</span>,
  <span class="dt">include=</span><span class="kw">c</span>(),
  <span class="dt">packages=</span><span class="kw">c</span>(<span class="st">'ggplot2'</span>),
  <span class="dt">sources=</span><span class="kw">c</span>(<span class="st">'script.R'</span>),
  <span class="dt">file_extensions=</span><span class="kw">c</span>(<span class="st">'ind'</span>),
  <span class="dt">ind_complete=</span><span class="ot">FALSE</span>)
## run all tasks with
## task_plan_2_ind:
##   command: make(I('task_plan_2'), remake_file='task_plan_2.yml')
## [1] &quot;task_plan_2.yml&quot;</code></pre></div>
<p>Now here are the contents of task_plan_2.yml, which will not create any <code>.ind</code> files:</p>
<pre><code># Do not edit - automatically generated
# from the task_makefile.mustache template
# by create_task_makefile() via eval()

target_default: task_plan_2

packages:
  - ggplot2

sources:
  - script.R

file_extensions:
  - &quot;ind&quot;

targets:
  # --- WI --- #
  
  WI_prep:
    command: prep(I('WI'))

  WI_plot.png:
    command: visualize(
      plot_name = target_name,
      state_data = WI_prep,
      state_capital = I('Madison'))

  WI.pdf:
    command: report(target_name)
    depends:
      - WI_plot.png

  # --- AZ --- #
  
  AZ_prep:
    command: prep(I('AZ'))

  AZ_plot.png:
    command: visualize(
      plot_name = target_name,
      state_data = AZ_prep,
      state_capital = I('Phoenix'))

  AZ.pdf:
    command: report(target_name)
    depends:
      - AZ_plot.png

  # --- PA --- #
  
  PA_prep:
    command: prep(I('PA'))

  PA_plot.png:
    command: visualize(
      plot_name = target_name,
      state_data = PA_prep,
      state_capital = I('Harrisburg'))

  PA.pdf:
    command: report(target_name)
    depends:
      - PA_plot.png

  # --- Overall job --- #

  task_plan_2:
    command: hash_dependencies(target_name=target_name, remake_file=I('task_plan_2.yml'))
    depends: 
      - WI.pdf
      - AZ.pdf
      - PA.pdf</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
